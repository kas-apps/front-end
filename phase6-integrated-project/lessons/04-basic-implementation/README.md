# Lesson 4: 基本機能の実装 ⚙️

**学習時間の目安：3-4時間**

---

## 学習目標

このレッスンを終えると、以下のことができるようになるよ！

- [ ] タスクの追加機能を実装できる
- [ ] タスクの表示機能を実装できる
- [ ] 配列とオブジェクトでデータを管理できる
- [ ] DOM操作で動的にUIを生成できる
- [ ] フォームバリデーションを実装できる
- [ ] イベントリスナーで各種操作を実装できる
- [ ] 統計情報を表示できる

---

## なぜこのステップが重要か（Why）

Lesson 1-3で、「何を作るか」（要件定義）、「どう作るか」（仕様書）、「どう見せるか」（UIデザイン）を決めたね！

いよいよ**コードを書いて、動くものを作る**フェーズに入るよ！

### 基本機能から始める理由

いきなり全機能を実装しようとすると：

```text
❌ よくある失敗パターン：
「全部の機能を一気に実装しよう！」
↓
コードがぐちゃぐちゃに...
↓
どこでエラーが出ているか分からない...
↓
最初からやり直し 😭
```

でも、基本機能から段階的に実装すれば：

```text
✅ 成功するパターン：
「まずは追加と表示だけ作ろう！」
↓
動いた！✨
↓
「次は削除機能を追加しよう！」
↓
また動いた！✨
↓
少しずつ機能を追加して完成！🎉
```

**小さく作って、動作確認して、少しずつ拡張する**のが成功の秘訣！

### Lesson 4 で実装する機能

このレッスンでは、以下の必須機能を実装するよ：

- ✅ タスクの追加
- ✅ タスクの一覧表示（カード形式）
- ✅ タスクの完了/未完了の切り替え
- ✅ タスクの削除
- ✅ 統計表示（全体、完了、未完了の数）

これだけあれば、**最小限のTODOアプリとして動作する**よ！

**編集、フィルター、ソート、LocalStorageなどは、Lesson 5-6で追加していくよ！**

---

## このステップで行うこと（What）

Lesson 4では、以下の流れで実装を進めていくよ：

### ステップ1：プロジェクトのセットアップ

- HTMLファイルの作成（基本構造とTailwind CDN）
- CSSファイルの作成（カスタムスタイル）
- JavaScriptファイルの作成（空ファイル）

### ステップ2：HTMLの構造を作る

- タスク追加フォーム
- タスク一覧表示エリア
- 統計表示エリア

### ステップ3：JavaScriptでデータ管理

- タスク配列の定義
- DOM要素の取得

### ステップ4：タスク追加機能

- フォームからデータを取得
- バリデーション
- タスクオブジェクトを作成
- 配列に追加
- フォームをクリア

### ステップ5：タスク表示機能

- タスク配列をループして、カードを生成
- Tailwind CSSでスタイリング
- タスク一覧エリアに追加

### ステップ6：完了切替機能

- チェックボックスのイベントリスナー
- completed フラグの切り替え
- UIの再描画

### ステップ7：削除機能

- 削除ボタンのイベントリスナー
- 確認ダイアログ
- 配列から削除
- UIの再描画

### ステップ8：統計表示機能

- 全タスク数、完了数、未完了数を計算
- 統計エリアに表示

---

## 事例：カード型TODOアプリの基本実装（How）

それでは、実際に基本機能を実装していこう！

### ステップ1：プロジェクトのセットアップ

まず、3つのファイルを作成するよ：

```text
04-basic-implementation/
└── code/
    ├── index.html
    ├── styles.css
    └── script.js
```

---

## 🤖 AIとの協働（最重要セクション）

### AIへの指示例

実装フェーズでは、AIに「コードを生成」してもらうことが多いよ。
**具体的で詳細な指示**を出すのがポイント！

#### ❌ 悪い指示の例1：HTMLの作成

```text
「TODOアプリのHTMLを作ってください。」
```

**何が悪い？**

- どんなUIなのか不明
- どんな要素が必要なのか不明
- Tailwind CSSを使うのか分からない

#### ✅ 良い指示の例1：HTMLの作成

```text
「Tailwind CSSを使って、TODOアプリのHTMLを作成してください。

【要件】
1. Tailwind CSS 3.x をCDNで読み込む
2. 以下のセクションを含める：
   - ヘッダー（アプリタイトル「Card Todo」）
   - タスク追加フォーム（タイトル、説明、優先度、カテゴリ、締切日の入力欄）
   - 統計表示エリア（全タスク数、完了数、未完了数）
   - タスク一覧表示エリア（Gridレイアウト、id="task-list"）

【デザイン】
- ヘッダーは中央寄せ、大きなフォント、グラデーション背景
- フォームは最大幅800px、中央寄せ、影付きカード
- 各入力欄にラベルとプレースホルダー
- 送信ボタンは青色、ホバーで濃くなる
- タスク一覧はGrid、モバイル1カラム、タブレット2カラム、デスクトップ3カラム

具体的なHTMLコードを教えてください。」
```

**何が良い？**

- Tailwind CSSの使用が明確
- 必要な要素が具体的にリストアップされている
- デザインの方向性が示されている
- レスポンシブの要件が明確

---

#### ❌ 悪い指示の例2：JavaScriptの実装

```text
「タスクを追加する関数を書いてください。」
```

**何が悪い？**

- データ構造が不明
- どのDOM要素を操作するのか不明
- どんなバリデーションが必要か不明

#### ✅ 良い指示の例2：JavaScriptの実装

```text
「タスクを追加する機能をJavaScriptで実装してください。

【データ構造】
const tasks = [];

const task = {
  id: number,                    // タイムスタンプ
  title: string,                 // タスクタイトル
  description: string,           // タスクの説明
  priority: 'high' | 'medium' | 'low',
  category: 'work' | 'personal' | 'shopping',
  dueDate: string | null,        // YYYY-MM-DD形式
  completed: boolean,
  createdAt: string              // ISO 8601形式
};

【要件】
1. フォームのsubmitイベントをリスンする
2. preventDefault()でページリロードを防ぐ
3. 各input要素からvalue を取得
4. バリデーション：タイトルが空の場合はアラート表示して中断
5. 新しいtaskオブジェクトを作成（idはDate.now()）
6. tasks配列にpushする
7. renderTasks()関数を呼んで画面を更新
8. フォームをリセット

【DOM要素のID】
- フォーム：task-form
- タイトル入力：task-title
- 説明入力：task-description
- 優先度選択：task-priority
- カテゴリ選択：task-category
- 締切日入力：task-due-date

具体的なコードを教えてください。」
```

**何が良い？**

- データ構造が明確
- 処理の流れが具体的
- DOM要素のIDが指定されている
- エラーハンドリング（バリデーション）も含まれている

---

### AIとの対話の進め方

実装フェーズでは、以下のようにAIと対話を重ねていくよ：

#### 対話例1：HTMLの作成

```text
あなた：
「Tailwind CSSを使って、TODOアプリのHTMLを作成してください。
[上記の詳細な指示]」

AI：
（HTMLコードを生成）

あなた：
「ありがとうございます！フォームの入力欄の間隔をもう少し広げたいです。
mb-4 を mb-6 に変更してもらえますか？」

AI：
（修正されたHTMLコードを生成）
```

#### 対話例2：JavaScriptの実装

```text
あなた：
「タスクを追加する機能をJavaScriptで実装してください。
[上記の詳細な指示]」

AI：
（JavaScriptコードを生成）

あなた：
「動きました！ただ、バリデーションで、タイトルが100文字を超える場合も
エラーメッセージを表示したいです。どう修正すればいいですか？」

AI：
（修正されたコードと説明を生成）
```

#### 対話例3：カード表示の実装

```text
あなた：
「タスクをカード形式で表示するrenderTasks()関数を実装してください。

【要件】
1. tasks配列をループ
2. 各taskに対してカードのHTML文字列を生成
3. カードには以下を含める：
   - タイトル（h3タグ、フォント大きめ）
   - 説明（pタグ、2行まで、超えたら省略記号）
   - 優先度バッジ（高=赤bg-red-500、中=黄bg-yellow-500、低=緑bg-green-500）
   - カテゴリ表示
   - 締切日（設定されている場合のみ）
   - 完了チェックボックス（task.completed が true ならチェック）
   - 削除ボタン（赤色、右下）
4. カードは角丸（rounded-lg）、影（shadow-md）、padding（p-6）
5. task-listエリアにinnerHTMLで表示
6. チェックボックスと削除ボタンにonclick属性を追加
   （例：onclick="toggleComplete(${task.id})"）

Tailwind CSSを使って、具体的なコードを教えてください。」

AI：
（renderTasks()関数のコードを生成、カードのHTML構造も含む）
```

### 生成されたコードのチェックポイント

AIからコードをもらったら、以下をチェックしよう：

#### HTML

- ✅ **Tailwind CDN**

  - `<script src="https://cdn.tailwindcss.com"></script>` が含まれているか
  - headタグ内に配置されているか

- ✅ **必要な要素**

  - フォームのすべての入力欄があるか
  - input/select/textarea に正しいIDが付いているか
  - 統計表示エリアがあるか
  - task-listエリアがあるか

- ✅ **レスポンシブ**

  - タスク一覧に `grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3` があるか
  - モバイル、タブレット、デスクトップで適切に表示されるか

- ✅ **スクリプトの読み込み**
  - `<script src="script.js"></script>` が body の最後にあるか

#### JavaScript

- ✅ **データ構造**

  - tasks配列がグローバルに定義されているか
  - taskオブジェクトが仕様通りのプロパティを持っているか

- ✅ **DOM要素の取得**

  - querySelector/getElementById で要素を取得しているか
  - 取得している要素のIDがHTMLと一致しているか

- ✅ **イベントリスナー**

  - addEventListener が使われているか（onclick属性ではなく）
  - フォームのsubmitイベントで preventDefault() が呼ばれているか

- ✅ **バリデーション**

  - タイトルが空の場合のチェックがあるか
  - エラーメッセージが分かりやすいか

- ✅ **関数の分割**

  - addTask()、renderTasks()、toggleComplete()、deleteTask() など、適切に関数が分割されているか
  - 関数名が何をするか分かりやすいか

- ✅ **動作確認**
  - コンソールエラーが出ないか
  - タスクが追加されるか
  - 完了切替と削除が動くか

---

## あなたのプロジェクトでの実践

事例（TODOアプリ）を参考に、自分のプロジェクトで基本実装を進めてみよう！

### 他のプロジェクトの場合

#### 例：レシピ管理アプリの場合

```text
データ構造を置き換える：
task → recipe

const recipe = {
  id: number,
  name: string,           // タスクのtitleに相当
  ingredients: string,    // タスクのdescriptionに相当
  steps: string,          // 手順
  cookingTime: number,    // 調理時間（分）
  difficulty: 'easy' | 'medium' | 'hard',  // priorityに相当
  category: 'japanese' | 'western' | 'chinese',  // カテゴリ
  createdAt: string
};
```

同じパターンで、どんなアプリでも実装できるよ！

---

## よくある問題と解決方法

### 問題1：「タスクが追加されない」

**症状**：

- フォームを送信してもタスクが表示されない
- コンソールにエラーも出ない

**解決方法**：

```javascript
// console.logでデバッグしよう！

function addTask(e) {
  e.preventDefault();
  console.log('addTask関数が呼ばれた'); // ←追加

  const title = document.getElementById('task-title').value;
  console.log('タイトル:', title); // ←追加

  // ...続く
}

// どこまで実行されているか確認できる！
```

**AIに相談する場合**：

```text
「タスクを追加してもカードが表示されません。
以下のコードで、どこが問題か教えてください。

[コードを貼り付け]

console.logで確認したところ、ここまでは実行されています：
- addTask関数は呼ばれている
- titleの値は正しく取得できている」
```

### 問題2：「タスクカードのレイアウトが崩れる」

**症状**：

- カードが縦に長すぎる
- カードが横並びにならない
- モバイルで見ると変

**解決方法**：

```text
AIに相談：
「タスクカードのレイアウトが崩れています。
以下の問題を修正したいです：

1. カードが横並びにならない（3カラムにしたい）
2. カードの高さを統一したい
3. モバイルでは1カラムにしたい

現在のHTMLコード：
[task-listのdiv部分を貼り付け]

Tailwind CSSでどのクラスを使えばいいですか？」
```

### 問題3：「削除ボタンが動かない」

**症状**：

- 削除ボタンをクリックしても何も起こらない
- コンソールに `deleteTask is not defined` のエラー

**解決方法**：

```javascript
// onclick属性を使っている場合、関数がグローバルスコープにないとエラーになる

// ❌ 悪い例
document.addEventListener('DOMContentLoaded', () => {
  function deleteTask(id) {  // この関数はグローバルスコープにない！
    // ...
  }
});

// ✅ 良い例
function deleteTask(id) {  // グローバルスコープに定義
  // ...
}

document.addEventListener('DOMContentLoaded', () => {
  // ...
});
```

**または、イベントデリゲーションを使う：**

```javascript
// タスク一覧全体にイベントリスナーを設定
document.getElementById('task-list').addEventListener('click', (e) => {
  if (e.target.classList.contains('delete-btn')) {
    const taskId = e.target.dataset.taskId;
    deleteTask(taskId);
  }
});
```

---

## 実装の流れ（ステップバイステップ）

### ステップ1：HTMLを作成

1. AIに詳細な指示を出してHTMLを生成してもらう
2. index.htmlにコードをコピペ
3. ブラウザで開いて、レイアウトを確認
4. 問題があればAIに修正を依頼

### ステップ2：JavaScriptの基本構造

1. AIにデータ構造とDOM取得のコードを生成してもらう
2. script.jsにコードをコピペ
3. console.logで動作確認

### ステップ3：タスク追加機能

1. AIにaddTask()関数を生成してもらう
2. script.jsに追加
3. ブラウザでフォームを送信して動作確認
4. console.logでtasks配列を確認

### ステップ4：タスク表示機能

1. AIにrenderTasks()関数を生成してもらう
2. script.jsに追加
3. ブラウザでタスクが表示されるか確認
4. レイアウトが崩れていたらAIに修正を依頼

### ステップ5：完了切替と削除機能

1. AIにtoggleComplete()とdeleteTask()を生成してもらう
2. script.jsに追加
3. ブラウザで動作確認

### ステップ6：統計表示機能

1. AIにupdateStats()関数を生成してもらう
2. script.jsに追加
3. renderTasks()の最後でupdateStats()を呼ぶ
4. ブラウザで統計が正しく表示されるか確認

---

## 実践課題

### 課題1：サンプルコードを動かす

まずは、このlessonのcode/フォルダにあるサンプルコードを動かしてみよう：

👉 [サンプルコード](code/)

- index.htmlをブラウザで開く
- タスクを追加してみる
- 完了切替と削除を試す
- 統計が更新されるか確認

### 課題2：AIと対話してコードを生成

サンプルコードを見る前に、AIと対話してコードを生成してみよう：

```text
指示例：
「Tailwind CSSを使って、TODOアプリの基本機能を実装してください。
[Lesson 1の要件定義書を参考に、詳細な指示を出す]」
```

### 課題3：カスタマイズに挑戦

サンプルコードをベースに、以下のカスタマイズを試そう：

- [ ] 優先度の色を変更（赤→オレンジなど）
- [ ] カテゴリを追加（「学習」「運動」など）
- [ ] 完了したタスクを下に表示（ソート）
- [ ] タスクカードに作成日時を表示

### チェックリスト

以下の項目をチェックして、Lesson 4を完了しよう：

- [ ] HTMLで基本構造を作成できた
- [ ] Tailwind CSSでスタイリングできた
- [ ] タスクを追加できる
- [ ] タスクがカード形式で表示される
- [ ] 完了/未完了を切り替えられる
- [ ] タスクを削除できる
- [ ] 統計が正しく表示される
- [ ] モバイル・タブレット・デスクトップで適切に表示される
- [ ] コンソールにエラーが出ない

全部チェックできたら、次は Lesson 5（機能の拡張）へ進もう！

---

## まとめ

Lesson 4 では、**基本機能を実装して、動くTODOアプリを作った**ね！

### 学んだこと

- ✅ Tailwind CSSを使ったHTMLの構造
- ✅ JavaScriptでのデータ管理（配列とオブジェクト）
- ✅ DOM操作でのタスクカード生成
- ✅ イベントリスナーでの各種操作
- ✅ フォームバリデーション
- ✅ AIへの具体的で詳細な指示の出し方
- ✅ 生成されたコードのチェックポイント

### 次のステップ

Lesson 4 で基本機能が動くようになったら、次は**機能を拡張**するよ！

Lesson 5 では、以下を学ぶよ：

- タスクの編集（インライン編集）
- フィルター機能（完了/未完了、カテゴリ別）
- ソート機能（優先度順、締切日順など）
- 検索機能（タイトルと説明で検索）

**基本機能が動いたら、どんどん機能を追加していこう！** 🚀

👉 [Lesson 5: 機能の拡張 へ進む](../05-feature-expansion/README.md)

---

**Let's vibe and code!** 🎉

基本機能が動いた時の達成感、最高だよね！
AIと一緒に、楽しくコードを書いていこう！ 💪
