# Lesson 2: 仕様書の作成 📐

**学習時間の目安：2-3時間**

---

## 学習目標

このレッスンを終えると、以下のことができるようになるよ！

- [ ] 要件を技術仕様に落とし込める
- [ ] データ構造を設計できる
- [ ] 画面構成を考えられる
- [ ] LocalStorageの仕様を決められる
- [ ] AIに技術的な相談ができる
- [ ] 技術仕様書を作成できる

---

## なぜこのステップが重要か（Why）

Lesson 1で「何を作るか」（要件定義）が明確になったね！

でも、「作りたいもの」と「実際のコード」の間には、まだ大きなギャップがあるんだ：

```text
要件：「タスクに優先度を設定したい」
↓
❓ でも、どうやって？
↓
仕様：「priorityプロパティに'high'/'medium'/'low'を格納」
```

**仕様書は、要件と実装をつなぐ橋渡し**なんだ！

### 仕様書がないと起こること

```text
❌ 仕様書なしでコードを書くと...

「タスクオブジェクトを作ろう」
↓
あれ、優先度はどう表現する？文字列？数値？
↓
あれ、IDはどう管理する？
↓
あれ、日付はどの形式で保存する？
↓
コードを書きながら考えて、矛盾が発生... 😭
```

### 仕様書があると起こること

```text
✅ 仕様書があれば...

「仕様書を見る」
↓
優先度：'high'/'medium'/'low' の文字列
ID：タイムスタンプ（Date.now()）
日付：ISO 8601形式（'2025-12-01T10:00:00.000Z'）
↓
迷わず実装できる！✨
```

**仕様書があれば、AIへの指示も超具体的になる**んだ！

---

## このステップで行うこと（What）

Lesson 2では、以下の流れで仕様書を作成していくよ：

### ステップ1：データ構造の設計

- タスクオブジェクトのプロパティを決める
- 各プロパティのデータ型を決める
- デフォルト値を決める

### ステップ2：画面構成の設計

- どんな画面要素が必要か整理する
- 各要素のID/クラス名を決める
- レイアウトの方針を決める

### ステップ3：LocalStorageの仕様決定

- どのキー名でデータを保存するか
- どのタイミングで保存・読み込みするか
- エラー時の処理を決める

### ステップ4：技術仕様書にまとめる

- 設計した内容をマークダウンで文書化
- コード例を含める
- AIに相談しながら最適化

---

## 事例：カード型TODOアプリの仕様書作成プロセス（How）

それでは、実際に仕様書を作成していこう！

### ステップ1：データ構造の設計

#### タスクオブジェクトの設計

Lesson 1の要件定義から、タスクに必要な情報を抜き出すよ：

```text
要件定義より：
- タスクタイトル（必須）
- タスクの説明（任意）
- 優先度（高・中・低）
- カテゴリ（仕事・プライベート・買い物）
- 締切日（任意）
- 完了フラグ（完了/未完了）
```

これをJavaScriptのオブジェクトに落とし込む：

```javascript
const task = {
  id: number,                    // 一意のID（タイムスタンプ）
  title: string,                 // タスクタイトル
  description: string,           // タスクの説明
  priority: 'high' | 'medium' | 'low',  // 優先度
  category: 'work' | 'personal' | 'shopping',  // カテゴリ
  dueDate: string | null,        // 締切日（YYYY-MM-DD形式、または null）
  completed: boolean,            // 完了フラグ
  createdAt: string              // 作成日時（ISO 8601形式）
};
```

#### データ型の選択理由

| プロパティ | データ型 | 理由 |
|-----------|---------|------|
| id | number | Date.now()でタイムスタンプを使用。一意性が保証される |
| title | string | テキスト情報 |
| description | string | テキスト情報（空文字列可） |
| priority | 'high' \| 'medium' \| 'low' | 文字列リテラル型。UIで表示しやすい |
| category | 'work' \| 'personal' \| 'shopping' | 文字列リテラル型。拡張しやすい |
| dueDate | string \| null | YYYY-MM-DD形式。nullは締切なしを表す |
| completed | boolean | true/falseで単純明快 |
| createdAt | string | ISO 8601形式。ソート・表示が容易 |

#### タスク配列の設計

```javascript
// すべてのタスクを格納する配列
const tasks = [
  {
    id: 1638360000000,
    title: "Phase 6の教材を完成させる",
    description: "Lesson 1-8とfinal-projectを作成",
    priority: "high",
    category: "work",
    dueDate: "2025-12-15",
    completed: false,
    createdAt: "2025-12-01T10:00:00.000Z"
  },
  // ...他のタスク
];
```

---

## 🤖 AIとの協働（最重要セクション）

### AIへの指示例

仕様書作成フェーズでは、AIに「技術的な相談」をすることが多いよ。

#### ❌ 悪い指示の例

```text
「タスクのデータ構造を教えてください。」
```

**何が悪い？**

- どんなタスクなのか不明
- どんな情報を持つのか不明
- 要件が伝わっていない

#### ✅ 良い指示の例

```text
「以下の要件を実現するために、データ構造を設計したいです。

【要件】
- タスクにはタイトル、説明、優先度、カテゴリ、締切日がある
- タスクは完了/未完了を切り替えられる
- 優先度は「高・中・低」の3段階
- カテゴリは「仕事」「プライベート」「買い物」の3種類
- 締切日は任意（設定しない場合もある）

【制約】
- JavaScriptのオブジェクトと配列で表現する
- LocalStorageに保存できる形式にする
- 一意のIDが必要

JavaScriptのオブジェクト構造を、具体例と一緒に提案してください。
各プロパティのデータ型と、その選択理由も教えてください。」
```

**何が良い？**

- 要件が具体的に列挙されている
- 制約条件が明確
- 期待する回答の形式が示されている

---

### AIとの対話の進め方

仕様書作成フェーズでは、以下のようにAIと対話を重ねていくよ：

#### 対話例1：データ構造の相談

```text
あなた：
「以下の要件を実現するために、データ構造を設計したいです。
[上記の詳細な指示]」

AI：
以下のようなデータ構造を提案します：

const task = {
  id: Date.now(),
  title: string,
  description: string,
  priority: 'high' | 'medium' | 'low',
  category: 'work' | 'personal' | 'shopping',
  dueDate: string | null,
  completed: false,
  createdAt: new Date().toISOString()
};

【選択理由】
- id: タイムスタンプで一意性を保証
- priority: 文字列で直感的、UIでそのまま使える
- dueDate: YYYY-MM-DD形式、<input type="date">と互換性あり
- createdAt: ISO 8601形式、ソートやフィルターが容易

あなた：
「ありがとうございます！priorityを数値（1,2,3）にした場合と
文字列（'high','medium','low'）にした場合、
それぞれのメリット・デメリットを教えてください。」

AI：
【数値の場合】
メリット：
- ソートが簡単（1 < 2 < 3）
- メモリ効率が良い

デメリット：
- UIで表示する際に変換が必要
- コードの可読性が下がる（3が高優先度？低優先度？）

【文字列の場合】
メリット：
- コードの可読性が高い
- UIでそのまま使える
- 拡張しやすい（'urgent'を追加など）

デメリット：
- ソート時に優先順位の配列が必要

推奨：初級〜中級者には文字列がおすすめです。
```

#### 対話例2：画面構成の相談

```text
あなた：
「カード型TODOアプリの画面構成を設計したいです。
以下の要素が必要です：

1. ヘッダー（アプリタイトル）
2. 統計表示（全タスク数、完了数、未完了数）
3. タスク追加フォーム
4. タスク一覧（カード形式、Grid レイアウト）

各セクションに適切なID/クラス名を提案してください。
また、HTML5のセマンティックタグも使いたいです。」

AI：
以下のような構成を提案します：

<header>
  <h1 id="app-title">Card Todo</h1>
</header>

<main>
  <!-- 統計表示 -->
  <section id="stats-section">
    <div id="total-count">0</div>
    <div id="incomplete-count">0</div>
    <div id="completed-count">0</div>
  </section>

  <!-- タスク追加フォーム -->
  <section id="add-task-section">
    <form id="task-form">
      <input id="task-title" />
      <textarea id="task-description"></textarea>
      <select id="task-priority"></select>
      <select id="task-category"></select>
      <input id="task-due-date" type="date" />
      <button type="submit">追加</button>
    </form>
  </section>

  <!-- タスク一覧 -->
  <section id="task-list-section">
    <div id="task-list" class="grid grid-cols-3">
      <!-- カードが動的に追加される -->
    </div>
  </section>
</main>

【命名規則】
- セクション：xxx-section
- フォーム関連：task-xxx
- 一覧表示：task-list
- 統計：xxx-count
```

#### 対話例3：LocalStorage仕様の相談

```text
あなた：
「LocalStorageでタスクデータを永続化したいです。
以下の仕様で問題ないか確認してください：

- キー名：'card-todo-tasks'
- 保存形式：JSON文字列
- 保存タイミング：タスク追加・編集・削除のたび
- 読み込みタイミング：ページ読み込み時
- エラー処理：try-catchでJSONパースエラーを捕捉

他に考慮すべき点はありますか？」

AI：
その仕様で基本的に問題ありません！
以下の点も考慮すると、より堅牢になります：

【追加の考慮点】
1. ストレージ容量チェック
   - LocalStorageは通常5-10MBまで
   - 大量のタスクでもエラーが出ないようにする

2. バージョン管理
   - データ構造が変わった時のマイグレーション
   - キー名に'v1'など含めることも検討

3. バックアップ機能
   - エクスポート/インポート機能があると安心

4. プライバシー
   - プライベートブラウズモードではLocalStorageが使えない
   - fallbackとして一時的にメモリに保持

【実装例】
function saveToLocalStorage() {
  try {
    const json = JSON.stringify(tasks);
    localStorage.setItem('card-todo-tasks', json);
  } catch (error) {
    console.error('保存に失敗:', error);
    // エラーをユーザーに通知
  }
}
```

### 生成された仕様のチェックポイント

AIから仕様の提案をもらったら、以下をチェックしよう：

- ✅ **データ構造**

  - すべての要件がプロパティとして表現されているか
  - データ型が適切か（string, number, boolean, null）
  - 一意のIDが設計されているか

- ✅ **画面構成**

  - 必要な要素がすべて含まれているか
  - ID/クラス名が分かりやすいか
  - セマンティックタグが使われているか

- ✅ **LocalStorage仕様**

  - キー名が明確か
  - 保存・読み込みのタイミングが適切か
  - エラー処理が考慮されているか

- ✅ **実装可能性**
  - Phase 0-5の知識で実装できるか
  - 複雑すぎないか
  - 拡張しやすいか

---

## あなたのプロジェクトでの実践

事例（TODOアプリ）を参考に、自分のプロジェクトで仕様書を作成してみよう！

### 他のプロジェクトの場合

#### 例：レシピ管理アプリの場合

```text
【要件から】
- レシピ名、材料、手順が必要
- 調理時間と難易度も管理したい
- お気に入り機能が欲しい

【データ構造に落とし込む】
const recipe = {
  id: number,
  name: string,              // レシピ名
  ingredients: string,       // 材料（改行区切り）
  steps: string,             // 手順（改行区切り）
  cookingTime: number,       // 調理時間（分）
  difficulty: 'easy' | 'medium' | 'hard',
  favorite: boolean,         // お気に入りフラグ
  createdAt: string
};

【LocalStorage】
- キー名：'recipe-manager-recipes'
- 保存形式：JSON文字列
- タイミング：追加・編集・削除のたび
```

同じパターンで、どんなアプリでも仕様書を作成できるよ！

---

## よくある問題と解決方法

### 問題1：プロパティが多すぎる

**症状**：

- タスクオブジェクトのプロパティが10個以上に...
- どれが必須でどれが任意か分からない

**解決方法**：

```text
1. Phase 1（必須機能）で使うプロパティだけを決める
2. Phase 2（拡張機能）で追加するプロパティは後で追加

【最初】
const task = {
  id, title, completed  // これだけでTODOアプリは動く
};

【後で追加】
const task = {
  id, title, completed,
  description, priority, category, dueDate  // 徐々に追加
};
```

### 問題2：データ型の選択で迷う

**症状**：

- 日付はstring？Date？number？
- 優先度はstring？number？

**解決方法**：

```text
AIに相談しよう：
「締切日を管理するのに、以下のどの方法が良いですか？
1. 文字列（'2025-12-15'）
2. Dateオブジェクト
3. タイムスタンプ（number）

それぞれのメリット・デメリットと、初級者への推奨を教えてください。」

【答え】
初級者には文字列（YYYY-MM-DD）がおすすめ：
- <input type="date">と直接やり取りできる
- LocalStorageに保存しやすい
- 表示も簡単
```

### 問題3：仕様が曖昧

**症状**：

- 「タスクを表示する」だけでは、どう表示するか不明
- 実装時に迷う

**解決方法**：

```text
仕様は「5W1H」で具体化：

❌ 悪い仕様：
「タスクを表示する」

✅ 良い仕様：
「tasks配列をループして、各taskに対してカードのHTMLを生成し、
task-list要素のinnerHTMLに挿入する。
カードには、タイトル（h3）、説明（p、2行まで）、優先度バッジ、
完了チェックボックス、削除ボタンを含める。」
```

---

## 実践課題

### 課題1：事例の仕様書を読む

まずは、カード型TODOアプリの仕様書を読んでみよう：

👉 [事例：カード型TODOアプリの仕様書](example-spec.md)

どのように技術仕様がまとめられているか、参考にしよう！

### 課題2：AIと対話してデータ構造を設計

実際にAIと対話して、データ構造を設計してみよう：

```text
指示例：
「以下の要件を実現するために、データ構造を設計したいです。

【要件】
[Lesson 1で作成した要件定義を貼り付け]

JavaScriptのオブジェクト構造を、具体例と一緒に提案してください。」
```

### 課題3：自分のプロジェクトの仕様書を書く

テンプレートを使って、自分のプロジェクトの仕様書を書いてみよう：

👉 [仕様書テンプレート](your-spec-template.md)

### チェックリスト

以下の項目をチェックして、Lesson 2を完了しよう：

- [ ] データ構造を設計できた
- [ ] 各プロパティのデータ型を決められた
- [ ] 画面構成を設計できた
- [ ] LocalStorageの仕様を決められた
- [ ] AIに技術的な相談ができた
- [ ] 事例の仕様書を読んだ
- [ ] 自分のプロジェクトの仕様書を作成した

全部チェックできたら、次は Lesson 3（UIデザインとプロトタイプ）へ進もう！

---

## まとめ

Lesson 2 では、**要件を技術仕様に落とし込む**方法を学んだね！

### 学んだこと

- ✅ データ構造の設計方法
- ✅ プロパティとデータ型の選び方
- ✅ 画面構成の設計方法
- ✅ LocalStorage仕様の決め方
- ✅ AIに技術的な相談をする方法
- ✅ 仕様書の書き方

### 次のステップ

Lesson 2 で「どう作るか」が決まったら、次は **「どう見せるか」** を設計するよ！

Lesson 3 では、以下を学ぶよ：

- UIデザインの基本原則
- ワイヤーフレームの作成
- Tailwind CSSを使ったUIコンポーネント設計
- 静的プロトタイプの作成

**仕様が決まったら、見た目をデザインしていこう！** 🎨

👉 [Lesson 3: UIデザインとプロトタイプ へ進む](../03-ui-design/README.md)

---

**Let's vibe and code!** 🎉

仕様書は地味に感じるかもしれないけど、実装がスムーズに進む秘訣だよ！
AIと一緒に、しっかり設計していこう！ 📐
