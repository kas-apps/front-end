<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å•é¡Œ 4-7: å®Œå…¨ãªTODOã‚¢ãƒ—ãƒªï¼ˆCRUDæ“ä½œï¼‰</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #8e2de2 0%, #4a00e0 100%);
        min-height: 100vh;
        padding: 40px 20px;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
      }

      header {
        background: white;
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        text-align: center;
        margin-bottom: 30px;
      }

      h1 {
        color: #8e2de2;
        margin-bottom: 10px;
        font-size: 36px;
      }

      .subtitle {
        color: #666;
        font-size: 16px;
      }

      /* è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  */
      .add-section {
        background: white;
        border-radius: 20px;
        padding: 25px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        margin-bottom: 25px;
      }

      .add-form {
        display: flex;
        gap: 10px;
      }

      #todoInput {
        flex: 1;
        padding: 15px;
        border: 2px solid #ddd;
        border-radius: 10px;
        font-size: 16px;
        transition: border-color 0.3s;
      }

      #todoInput:focus {
        outline: none;
        border-color: #8e2de2;
      }

      #addBtn {
        background: linear-gradient(135deg, #8e2de2 0%, #4a00e0 100%);
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 10px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      #addBtn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(142, 45, 226, 0.4);
      }

      #addBtn:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
      }

      /* ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã¨ã‚«ã‚¦ãƒ³ãƒˆ */
      .controls {
        background: white;
        border-radius: 20px;
        padding: 20px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        margin-bottom: 25px;
      }

      .filter-buttons {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
        flex-wrap: wrap;
      }

      .filter-btn {
        flex: 1;
        min-width: 100px;
        padding: 10px 20px;
        border: 2px solid #ddd;
        background: white;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: bold;
        transition: all 0.3s;
      }

      .filter-btn:hover {
        border-color: #8e2de2;
        color: #8e2de2;
      }

      .filter-btn.active {
        background: linear-gradient(135deg, #8e2de2 0%, #4a00e0 100%);
        color: white;
        border-color: transparent;
      }

      .stats {
        display: flex;
        justify-content: space-around;
        padding-top: 15px;
        border-top: 2px solid #f5f5f5;
      }

      .stat-item {
        text-align: center;
      }

      .stat-number {
        font-size: 28px;
        font-weight: bold;
        color: #8e2de2;
      }

      .stat-label {
        font-size: 14px;
        color: #666;
        margin-top: 5px;
      }

      /* TODOãƒªã‚¹ãƒˆ */
      .todo-section {
        background: white;
        border-radius: 20px;
        padding: 25px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        min-height: 300px;
      }

      #todoList {
        display: grid;
        gap: 12px;
      }

      .todo-item {
        background: #f9f9f9;
        border: 2px solid #e0e0e0;
        border-radius: 12px;
        padding: 15px;
        display: flex;
        align-items: center;
        gap: 12px;
        transition: all 0.3s;
        animation: slideIn 0.3s ease-out;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateX(-20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .todo-item:hover {
        transform: translateX(5px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .todo-item.completed {
        background: #e8f5e9;
        border-color: #4caf50;
      }

      .todo-checkbox {
        width: 24px;
        height: 24px;
        cursor: pointer;
        accent-color: #8e2de2;
      }

      .todo-title {
        flex: 1;
        font-size: 16px;
        color: #333;
        transition: all 0.3s;
      }

      .todo-item.completed .todo-title {
        text-decoration: line-through;
        color: #999;
      }

      .delete-btn {
        background: #ff5252;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.3s;
      }

      .delete-btn:hover {
        background: #d32f2f;
      }

      .loading {
        text-align: center;
        padding: 60px;
        color: #8e2de2;
      }

      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #8e2de2;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #999;
      }

      .empty-state h3 {
        font-size: 24px;
        margin-bottom: 10px;
      }

      .error {
        background: #ff5252;
        color: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        margin: 20px 0;
      }

      /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
      @media (max-width: 768px) {
        h1 {
          font-size: 28px;
        }

        .add-form {
          flex-direction: column;
        }

        .filter-buttons {
          flex-direction: column;
        }

        .filter-btn {
          min-width: auto;
        }

        .stats {
          flex-direction: column;
          gap: 15px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>âœ… TODO ã‚¢ãƒ—ãƒª</h1>
        <p class="subtitle">CRUDæ“ä½œã‚’å®Œå…¨å®Ÿè£…ã—ãŸTODOã‚¢ãƒ—ãƒª</p>
      </header>

      <!-- è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  -->
      <div class="add-section">
        <form class="add-form" id="addForm">
          <input
            type="text"
            id="todoInput"
            placeholder="æ–°ã—ã„TODOã‚’å…¥åŠ›..."
            required
          />
          <button type="submit" id="addBtn">è¿½åŠ  â•</button>
        </form>
      </div>

      <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã¨ã‚«ã‚¦ãƒ³ãƒˆ -->
      <div class="controls">
        <div class="filter-buttons">
          <button class="filter-btn active" onclick="setFilter('all')">
            å…¨ã¦
          </button>
          <button class="filter-btn" onclick="setFilter('incomplete')">
            æœªå®Œäº†
          </button>
          <button class="filter-btn" onclick="setFilter('completed')">
            å®Œäº†
          </button>
        </div>

        <div class="stats">
          <div class="stat-item">
            <div class="stat-number" id="totalCount">0</div>
            <div class="stat-label">å…¨TODO</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="incompleteCount">0</div>
            <div class="stat-label">æœªå®Œäº†</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="completedCount">0</div>
            <div class="stat-label">å®Œäº†</div>
          </div>
        </div>
      </div>

      <!-- TODOãƒªã‚¹ãƒˆ -->
      <div class="todo-section">
        <div id="todoList"></div>
      </div>
    </div>

    <script>
      // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
      let todos = []; // TODOä¸€è¦§ã‚’ä¿å­˜
      let currentFilter = "all"; // ç¾åœ¨ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼

      // HTMLè¦ç´ ã‚’å–å¾—
      const addForm = document.getElementById("addForm");
      const todoInput = document.getElementById("todoInput");
      const addBtn = document.getElementById("addBtn");
      const todoList = document.getElementById("todoList");
      const totalCount = document.getElementById("totalCount");
      const incompleteCount = document.getElementById("incompleteCount");
      const completedCount = document.getElementById("completedCount");

      // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«TODOã‚’å–å¾—
      document.addEventListener("DOMContentLoaded", () => {
        console.log("TODOã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã—ã¾ã™ï¼");
        fetchTodos();
      });

      // 1. å–å¾—ï¼ˆReadï¼‰ - GET
      async function fetchTodos() {
        console.log("--- TODOã‚’å–å¾—ã—ã¾ã™ ---");

        try {
          // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
          todoList.innerHTML = `
            <div class="loading">
              <div class="spinner"></div>
              <p>TODOã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
            </div>
          `;

          // JSONPlaceholder API ã‹ã‚‰TODOä¸€è¦§ã‚’å–å¾—
          const response = await fetch(
            "https://jsonplaceholder.typicode.com/todos?userId=1"
          );

          console.log("ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:", response.status);

          if (!response.ok) {
            throw new Error(`HTTPã‚¨ãƒ©ãƒ¼: ${response.status}`);
          }

          const data = await response.json();

          // æœ€åˆã®10ä»¶ã ã‘ä½¿ç”¨
          todos = data.slice(0, 10);

          console.log(`å–å¾—ã—ãŸTODOæ•°: ${todos.length}`);
          console.log("TODOãƒ‡ãƒ¼ã‚¿:", todos);

          // TODOä¸€è¦§ã‚’è¡¨ç¤º
          displayTodos();

          console.log("âœ… TODOå–å¾—å®Œäº†");
        } catch (error) {
          console.error("âŒ ã‚¨ãƒ©ãƒ¼:", error);
          todoList.innerHTML = `
            <div class="error">
              TODOã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}
            </div>
          `;
        }
      }

      // 2. ä½œæˆï¼ˆCreateï¼‰ - POST
      addForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const title = todoInput.value.trim();
        if (!title) return;

        console.log("--- æ–°ã—ã„TODOã‚’ä½œæˆã—ã¾ã™ ---");
        console.log("ã‚¿ã‚¤ãƒˆãƒ«:", title);

        try {
          // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
          addBtn.disabled = true;
          addBtn.textContent = "è¿½åŠ ä¸­...";

          // POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡
          const response = await fetch(
            "https://jsonplaceholder.typicode.com/todos",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                title: title,
                completed: false,
                userId: 1,
              }),
            }
          );

          console.log("ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:", response.status);

          if (!response.ok) {
            throw new Error(`HTTPã‚¨ãƒ©ãƒ¼: ${response.status}`);
          }

          const newTodo = await response.json();

          console.log("ä½œæˆã•ã‚ŒãŸTODO:", newTodo);

          // ãƒ­ãƒ¼ã‚«ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã«è¿½åŠ ï¼ˆä¸€è¦§ã®å…ˆé ­ã«ï¼‰
          todos.unshift(newTodo);

          // ç”»é¢ã‚’æ›´æ–°
          displayTodos();

          // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
          addForm.reset();

          console.log("âœ… TODOä½œæˆå®Œäº†");
        } catch (error) {
          console.error("âŒ ã‚¨ãƒ©ãƒ¼:", error);
          alert(`TODOã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
        } finally {
          // ãƒœã‚¿ãƒ³ã‚’å…ƒã«æˆ»ã™
          addBtn.disabled = false;
          addBtn.textContent = "è¿½åŠ  â•";
        }
      });

      // 3. æ›´æ–°ï¼ˆUpdateï¼‰ - PUT
      async function toggleTodo(id) {
        console.log("--- TODOã®çŠ¶æ…‹ã‚’æ›´æ–°ã—ã¾ã™ ---");
        console.log("TODO ID:", id);

        // å¯¾è±¡ã®TODOã‚’æ¢ã™
        const todo = todos.find((t) => t.id === id);
        if (!todo) {
          console.error("TODOãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
          return;
        }

        console.log("ç¾åœ¨ã®çŠ¶æ…‹:", todo.completed ? "å®Œäº†" : "æœªå®Œäº†");
        console.log("å¤‰æ›´å¾Œã®çŠ¶æ…‹:", todo.completed ? "æœªå®Œäº†" : "å®Œäº†");

        try {
          // PUTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡
          const response = await fetch(
            `https://jsonplaceholder.typicode.com/todos/${id}`,
            {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                ...todo,
                completed: !todo.completed, // çŠ¶æ…‹ã‚’åè»¢
              }),
            }
          );

          console.log("ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:", response.status);

          if (!response.ok) {
            throw new Error(`HTTPã‚¨ãƒ©ãƒ¼: ${response.status}`);
          }

          const updatedTodo = await response.json();

          console.log("æ›´æ–°ã•ã‚ŒãŸTODO:", updatedTodo);

          // ãƒ­ãƒ¼ã‚«ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
          todo.completed = !todo.completed;

          // ç”»é¢ã‚’æ›´æ–°
          displayTodos();

          console.log("âœ… TODOæ›´æ–°å®Œäº†");
        } catch (error) {
          console.error("âŒ ã‚¨ãƒ©ãƒ¼:", error);
          alert(`TODOã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
        }
      }

      // 4. å‰Šé™¤ï¼ˆDeleteï¼‰ - DELETE
      async function deleteTodo(id) {
        console.log("--- TODOã‚’å‰Šé™¤ã—ã¾ã™ ---");
        console.log("TODO ID:", id);

        // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
        if (!confirm("ã“ã®TODOã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
          console.log("å‰Šé™¤ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ");
          return;
        }

        try {
          // DELETEãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡
          const response = await fetch(
            `https://jsonplaceholder.typicode.com/todos/${id}`,
            {
              method: "DELETE",
            }
          );

          console.log("ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:", response.status);

          if (!response.ok) {
            throw new Error(`HTTPã‚¨ãƒ©ãƒ¼: ${response.status}`);
          }

          console.log("ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹:", await response.json());

          // ãƒ­ãƒ¼ã‚«ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å‰Šé™¤
          todos = todos.filter((t) => t.id !== id);

          // ç”»é¢ã‚’æ›´æ–°
          displayTodos();

          console.log("âœ… TODOå‰Šé™¤å®Œäº†");
        } catch (error) {
          console.error("âŒ ã‚¨ãƒ©ãƒ¼:", error);
          alert(`TODOã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
        }
      }

      // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¨­å®š
      function setFilter(filter) {
        console.log(`ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’å¤‰æ›´: ${filter}`);

        currentFilter = filter;

        // ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
        document.querySelectorAll(".filter-btn").forEach((btn) => {
          btn.classList.remove("active");
        });
        event.target.classList.add("active");

        // ç”»é¢ã‚’æ›´æ–°
        displayTodos();
      }

      // TODOä¸€è¦§ã‚’è¡¨ç¤º
      function displayTodos() {
        console.log("--- TODOä¸€è¦§ã‚’è¡¨ç¤ºã—ã¾ã™ ---");

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
        let filteredTodos = todos;
        if (currentFilter === "completed") {
          filteredTodos = todos.filter((t) => t.completed);
        } else if (currentFilter === "incomplete") {
          filteredTodos = todos.filter((t) => !t.completed);
        }

        console.log(`ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼: ${currentFilter}`);
        console.log(`è¡¨ç¤ºã™ã‚‹TODOæ•°: ${filteredTodos.length}`);

        // ã‚«ã‚¦ãƒ³ãƒˆã‚’æ›´æ–°
        const completed = todos.filter((t) => t.completed).length;
        const incomplete = todos.length - completed;

        totalCount.textContent = todos.length;
        completedCount.textContent = completed;
        incompleteCount.textContent = incomplete;

        // TODOãŒãªã„å ´åˆ
        if (filteredTodos.length === 0) {
          let message = "";
          if (currentFilter === "all") {
            message = "TODOãŒã‚ã‚Šã¾ã›ã‚“<br>æ–°ã—ã„TODOã‚’è¿½åŠ ã—ã¦ãã ã•ã„ï¼";
          } else if (currentFilter === "completed") {
            message = "å®Œäº†ã—ãŸTODOãŒã‚ã‚Šã¾ã›ã‚“";
          } else {
            message = "æœªå®Œäº†ã®TODOãŒã‚ã‚Šã¾ã›ã‚“<br>å…¨ã¦å®Œäº†ã—ã¾ã—ãŸï¼ğŸ‰";
          }

          todoList.innerHTML = `
            <div class="empty-state">
              <h3>ğŸ“</h3>
              <p>${message}</p>
            </div>
          `;
          return;
        }

        // TODOä¸€è¦§ã®HTMLã‚’ç”Ÿæˆ
        const html = filteredTodos
          .map(
            (todo) => `
              <div class="todo-item ${todo.completed ? "completed" : ""}">
                <input
                  type="checkbox"
                  class="todo-checkbox"
                  ${todo.completed ? "checked" : ""}
                  onchange="toggleTodo(${todo.id})"
                />
                <span class="todo-title">${todo.title}</span>
                <button class="delete-btn" onclick="deleteTodo(${todo.id})">
                  å‰Šé™¤
                </button>
              </div>
            `
          )
          .join("");

        todoList.innerHTML = html;

        console.log("âœ… è¡¨ç¤ºå®Œäº†");
      }

      // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
      console.log("=".repeat(50));
      console.log("å•é¡Œ 4-7: å®Œå…¨ãªTODOã‚¢ãƒ—ãƒªï¼ˆCRUDæ“ä½œï¼‰");
      console.log("=".repeat(50));
      console.log("ã“ã®ã‚¢ãƒ—ãƒªã¯ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ï¼š");
      console.log("ğŸ“– Read   (GET)    - TODOã®å–å¾—");
      console.log("â• Create (POST)   - TODOã®ä½œæˆ");
      console.log("âœï¸  Update (PUT)    - TODOã®æ›´æ–°");
      console.log("ğŸ—‘ï¸  Delete (DELETE) - TODOã®å‰Šé™¤");
      console.log("=".repeat(50));
      console.log(
        "F12ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã€é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’é–‹ãã¨ã€å„æ“ä½œã®è©³ç´°ãŒè¦‹ã‚‰ã‚Œã‚‹ã‚ˆï¼"
      );
    </script>
  </body>
</html>
