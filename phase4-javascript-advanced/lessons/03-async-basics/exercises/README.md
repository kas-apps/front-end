# Lesson 3: 非同期処理の基礎 - 演習問題 ⏱️

このレッスンで学んだ非同期処理を実践しよう！

---

## 基礎編

### 問題 3-1: setTimeout でカウントダウン

**課題**：
「開始」ボタンをクリックすると、3秒後に「時間になりました！」とアラート表示するプログラムを作成してください。また、「キャンセル」ボタンをクリックすると、タイマーをキャンセルできるようにしてください。

**ヒント**：

- `setTimeout()` でタイマーを設定
- `clearTimeout()` でタイマーをキャンセル
- タイマーIDを変数に保存しておく

---

### 問題 3-2: setInterval でリアルタイムカウンター

**課題**：
「開始」ボタンをクリックすると、1秒ごとに数字がカウントアップする（0, 1, 2, 3...）プログラムを作成してください。「停止」ボタンでカウントを止め、「リセット」ボタンでカウントを0に戻せるようにしてください。

**ヒント**：

- `setInterval()` で1秒ごとに実行
- `clearInterval()` でストップ
- カウンターの値を変数で管理

---

### 問題 3-3: Promise の基本

**課題**：
ボタンをクリックすると、2秒後にランダムで成功/失敗が決まる Promise を作成してください。成功時は「成功しました！🎉」、失敗時は「失敗しました😢」と画面に表示してください。

**ヒント**：

- `new Promise((resolve, reject) => {...})` で Promise を作成
- `Math.random() > 0.5` でランダムに成功/失敗を決める
- `.then()` と `.catch()` で結果を処理

---

## 応用編

### 問題 3-4: Promise チェーンで順番に処理

**課題**：
料理を作る工程を Promise チェーンで実装してください。以下の手順を順番に実行し、各ステップの完了を画面に表示してください。

1. 「材料を買う」（1秒）
2. 「材料を切る」（1秒）
3. 「料理する」（2秒）
4. 「盛り付ける」（1秒）
5. 「完成！🍽️」

各ステップは Promise を返す関数として実装し、`.then()` でチェーンしてください。

**ヒント**：

- 各ステップを関数にする（例: `buyIngredients()`）
- 各関数は Promise を返す
- `.then()` でチェーンする

---

### 問題 3-5: async/await への変換

**課題**：
問題 3-4 で作成した Promise チェーンを、**async/await** を使った書き方に変換してください。同じ動作をするプログラムを async/await で実装してください。

**ヒント**：

- 関数の前に `async` を付ける
- Promise の前に `await` を付ける
- try-catch でエラーハンドリング

---

### 問題 3-6: エラーハンドリング（AI への指示例付き）

**課題**：
ユーザー情報を取得する非同期関数を作成してください。以下の機能を実装してください。

- 「データ取得」ボタンをクリックすると、2秒後にランダムで成功/失敗
- 成功時：ユーザー情報（名前、年齢）を画面に表示
- 失敗時：「データの取得に失敗しました」とエラーメッセージを表示
- 取得中は「読み込み中...」と表示
- **try-catch-finally** を使ってエラーハンドリング
- **finally** でローディング表示を消す

**AI への指示例**：

```
「ユーザー情報を取得する非同期処理を実装してください：

1. 「データ取得」ボタンをクリックすると処理を開始
2. 処理開始時に「読み込み中...」を表示
3. 2秒後にランダムで成功/失敗を決定（Math.random() > 0.5で成功）
4. 成功時：ユーザー情報（name: '太郎', age: 25）を画面に表示
5. 失敗時：「データの取得に失敗しました」とエラーメッセージを表示
6. 成功でも失敗でも、finally でローディング表示を消す

async/await と try-catch-finally を使用してください。」
```

**ヒント**：

- `async function` で非同期関数を作成
- `try-catch-finally` でエラーハンドリング
- `finally` は成功でも失敗でも実行される

---

## チャレンジ

### 問題 3-7: 画像ローダー（Promise.all）

**課題**：
複数の画像を並行して読み込む画像ローダーを作成してください。以下の機能を**すべて**実装してください。

1. **画像URLの配列**：3〜5枚の画像URLを用意
2. **「読み込み開始」ボタン**：クリックすると画像の読み込みを開始
3. **Promise.all で並行読み込み**：すべての画像を同時に読み込む
4. **進捗表示**：「読み込み中... X / Y 枚」と表示
5. **ローディングアニメーション**：読み込み中はスピナーを表示
6. **成功時**：すべての画像をグリッドレイアウトで表示
7. **失敗時**：「画像の読み込みに失敗しました」とエラー表示
8. **読み込み時間の表示**：「X 秒で読み込み完了」と表示

**ヒント**：

- `Promise.all()` で複数の Promise を並行実行
- 各画像の読み込みを Promise でラップ
- 画像の読み込み：`new Image()` と `img.onload` / `img.onerror`
- `Date.now()` で読み込み時間を計測
- CSS Grid でグリッドレイアウト

**実装例の構造**：

```javascript
// 画像を読み込む関数（Promise を返す）
function loadImage(url) {
  return new Promise((resolve, reject) => {
    const img = new Image();
    img.onload = () => resolve(img);
    img.onerror = () => reject(new Error(`Failed to load ${url}`));
    img.src = url;
  });
}

// すべての画像を読み込む
async function loadAllImages() {
  const urls = [
    "https://picsum.photos/300/200?random=1",
    "https://picsum.photos/300/200?random=2",
    "https://picsum.photos/300/200?random=3",
  ];

  try {
    const images = await Promise.all(urls.map(loadImage));
    // すべての画像を表示
  } catch (error) {
    // エラー表示
  }
}
```

**チャレンジポイント**：

- 進捗表示をリアルタイムで更新（Promise.allSettled を使うと個別の結果が取れる）
- 画像のフェードインアニメーション
- 読み込みに失敗した画像だけ代替画像を表示
- 「再試行」ボタンで失敗した画像だけ再読み込み

---

## 解答例

演習問題を解いたら、解答例と比較してみよう！

👉 [解答例を見る](solutions/README.md)

---

**Let's vibe and code!** 🎉

実際に手を動かして、非同期処理をマスターしよう！特に async/await は、これからたくさん使うから、しっかり練習しておこうね！💪
