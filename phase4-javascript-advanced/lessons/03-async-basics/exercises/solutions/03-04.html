<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å•é¡Œ 3-4: Promise ãƒã‚§ãƒ¼ãƒ³ã§é †ç•ªã«å‡¦ç†</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      .container {
        background: white;
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 700px;
        width: 100%;
      }

      h1 {
        color: #333;
        margin-bottom: 10px;
        font-size: 28px;
        text-align: center;
      }

      .subtitle {
        color: #666;
        margin-bottom: 30px;
        font-size: 14px;
        text-align: center;
      }

      .cooking-steps {
        margin: 30px 0;
      }

      .step {
        display: flex;
        align-items: center;
        padding: 20px;
        margin-bottom: 15px;
        border-radius: 15px;
        background: #f8f9fa;
        border: 2px solid #e9ecef;
        transition: all 0.3s;
      }

      .step.active {
        background: linear-gradient(135deg, #fff5e6 0%, #ffe9cc 100%);
        border-color: #ffa500;
        transform: scale(1.02);
      }

      .step.completed {
        background: linear-gradient(135deg, #d4f7e8 0%, #c7f9e3 100%);
        border-color: #38ef7d;
      }

      .step-number {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: #e9ecef;
        color: #6c757d;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        margin-right: 15px;
        flex-shrink: 0;
      }

      .step.active .step-number {
        background: #ffa500;
        color: white;
        animation: pulse 1s infinite;
      }

      .step.completed .step-number {
        background: #38ef7d;
        color: white;
      }

      .step-content {
        flex: 1;
      }

      .step-title {
        font-weight: bold;
        color: #333;
        margin-bottom: 5px;
      }

      .step-description {
        font-size: 14px;
        color: #666;
      }

      .step-icon {
        font-size: 30px;
        margin-left: 15px;
      }

      .control-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin: 30px 0;
      }

      button {
        padding: 15px 30px;
        font-size: 16px;
        font-weight: bold;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s;
      }

      #startButton {
        background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        color: white;
      }

      #startButton:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(250, 112, 154, 0.4);
      }

      #resetButton {
        background: #6c757d;
        color: white;
      }

      #resetButton:hover {
        background: #5a6268;
        transform: translateY(-2px);
      }

      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none !important;
      }

      .log-box {
        background: #2d3748;
        color: #f7fafc;
        padding: 20px;
        border-radius: 10px;
        margin-top: 20px;
        max-height: 300px;
        overflow-y: auto;
        font-family: "Courier New", monospace;
        font-size: 13px;
      }

      .log-entry {
        margin-bottom: 8px;
        line-height: 1.6;
      }

      .log-entry.success {
        color: #38ef7d;
      }

      .log-entry.info {
        color: #ffa500;
      }

      .log-entry.complete {
        color: #ffd93d;
      }

      .info-box {
        background: #f8f9fa;
        border-left: 4px solid #fa709a;
        padding: 15px;
        margin-top: 30px;
        text-align: left;
        border-radius: 5px;
      }

      .info-box h3 {
        color: #fa709a;
        margin-bottom: 10px;
        font-size: 16px;
      }

      .info-box ul {
        margin-left: 20px;
        color: #666;
        font-size: 14px;
        line-height: 1.8;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ• Promise ãƒã‚§ãƒ¼ãƒ³ã§æ–™ç†</h1>
      <p class="subtitle">å•é¡Œ 3-4: å¿œç”¨ç·¨</p>

      <div class="cooking-steps">
        <div class="step" id="step1">
          <div class="step-number">1</div>
          <div class="step-content">
            <div class="step-title">ææ–™ã‚’è²·ã†</div>
            <div class="step-description">ãƒˆãƒãƒˆã€ãƒãƒ¼ã‚ºã€ç”Ÿåœ°ã‚’è³¼å…¥</div>
          </div>
          <div class="step-icon">ğŸ›’</div>
        </div>

        <div class="step" id="step2">
          <div class="step-number">2</div>
          <div class="step-content">
            <div class="step-title">ææ–™ã‚’åˆ‡ã‚‹</div>
            <div class="step-description">è³¼å…¥ã—ãŸææ–™ã‚’æº–å‚™</div>
          </div>
          <div class="step-icon">ğŸ”ª</div>
        </div>

        <div class="step" id="step3">
          <div class="step-number">3</div>
          <div class="step-content">
            <div class="step-title">æ–™ç†ã™ã‚‹</div>
            <div class="step-description">ã‚ªãƒ¼ãƒ–ãƒ³ã§ç„¼ã</div>
          </div>
          <div class="step-icon">ğŸ”¥</div>
        </div>

        <div class="step" id="step4">
          <div class="step-number">4</div>
          <div class="step-content">
            <div class="step-title">ç››ã‚Šä»˜ã‘ã‚‹</div>
            <div class="step-description">ãŠçš¿ã«ç¾ã—ãç››ã‚Šä»˜ã‘</div>
          </div>
          <div class="step-icon">ğŸ½ï¸</div>
        </div>
      </div>

      <div class="control-buttons">
        <button id="startButton">æ–™ç†ã‚’å§‹ã‚ã‚‹</button>
        <button id="resetButton">ãƒªã‚»ãƒƒãƒˆ</button>
      </div>

      <div class="log-box" id="logBox"></div>

      <div class="info-box">
        <h3>ğŸ’¡ å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ</h3>
        <ul>
          <li>Promise ãƒã‚§ãƒ¼ãƒ³ã§è¤‡æ•°ã®éåŒæœŸå‡¦ç†ã‚’é †ç•ªã«å®Ÿè¡Œ</li>
          <li>å„ .then() ã§æ¬¡ã® Promise ã‚’è¿”ã™ã“ã¨ã§ãƒã‚§ãƒ¼ãƒ³ãŒç¶šã</li>
          <li>ã‚¨ãƒ©ãƒ¼ã¯æœ€å¾Œã® .catch() 1ã¤ã§å…¨éƒ¨ã‚­ãƒ£ãƒƒãƒã§ãã‚‹</li>
          <li>ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯åœ°ç„ã‚ˆã‚Šèª­ã¿ã‚„ã™ãã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã—ã‚„ã™ã„</li>
        </ul>
      </div>
    </div>

    <script>
      // ==========================================
      // è¦ç´ ã®å–å¾—
      // ==========================================
      const startButton = document.getElementById("startButton");
      const resetButton = document.getElementById("resetButton");
      const logBox = document.getElementById("logBox");

      const steps = {
        step1: document.getElementById("step1"),
        step2: document.getElementById("step2"),
        step3: document.getElementById("step3"),
        step4: document.getElementById("step4"),
      };

      // ==========================================
      // ãƒ­ã‚°å‡ºåŠ›é–¢æ•°
      // ==========================================
      function log(message, type = "info") {
        const logEntry = document.createElement("div");
        logEntry.className = `log-entry ${type}`;
        const timestamp = new Date().toLocaleTimeString("ja-JP");
        logEntry.textContent = `[${timestamp}] ${message}`;
        logBox.appendChild(logEntry);

        // è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
        logBox.scrollTop = logBox.scrollHeight;

        console.log(message);
      }

      // ==========================================
      // ã‚¹ãƒ†ãƒƒãƒ—ã®çŠ¶æ…‹ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
      // ==========================================
      function setStepActive(stepId) {
        // ã™ã¹ã¦ã®ã‚¹ãƒ†ãƒƒãƒ—ã‹ã‚‰ active ã‚’å‰Šé™¤
        Object.values(steps).forEach((step) => {
          step.classList.remove("active");
        });

        // æŒ‡å®šã•ã‚ŒãŸã‚¹ãƒ†ãƒƒãƒ—ã‚’ active ã«ã™ã‚‹
        steps[stepId].classList.add("active");
      }

      function setStepCompleted(stepId) {
        steps[stepId].classList.remove("active");
        steps[stepId].classList.add("completed");
      }

      // ==========================================
      // Promise ã‚’è¿”ã™æ–™ç†é–¢æ•°
      // ==========================================

      // ã‚¹ãƒ†ãƒƒãƒ—1: ææ–™ã‚’è²·ã†
      function buyIngredients() {
        return new Promise(function (resolve) {
          log("ğŸ›’ ææ–™ã‚’è²·ã„ã«è¡Œã...", "info");
          setStepActive("step1");

          setTimeout(function () {
            const ingredients = "ãƒˆãƒãƒˆã€ãƒãƒ¼ã‚ºã€ç”Ÿåœ°";
            log(`âœ… ææ–™ã‚’è²·ã£ã¦ããŸï¼ï¼ˆ${ingredients}ï¼‰`, "success");
            setStepCompleted("step1");
            resolve(ingredients);
          }, 1000);
        });
      }

      // ã‚¹ãƒ†ãƒƒãƒ—2: ææ–™ã‚’åˆ‡ã‚‹
      function cutIngredients(ingredients) {
        return new Promise(function (resolve) {
          log(`ğŸ”ª ææ–™ã‚’åˆ‡ã‚‹ï¼ˆ${ingredients}ï¼‰...`, "info");
          setStepActive("step2");

          setTimeout(function () {
            const prepared = "åˆ‡ã£ãŸ" + ingredients;
            log(`âœ… ææ–™ã‚’åˆ‡ã‚Šçµ‚ãˆãŸï¼`, "success");
            setStepCompleted("step2");
            resolve(prepared);
          }, 1000);
        });
      }

      // ã‚¹ãƒ†ãƒƒãƒ—3: æ–™ç†ã™ã‚‹
      function cook(preparedIngredients) {
        return new Promise(function (resolve) {
          log(`ğŸ”¥ æ–™ç†ã™ã‚‹ï¼ˆ${preparedIngredients}ï¼‰...`, "info");
          setStepActive("step3");

          setTimeout(function () {
            const food = "ç¾å‘³ã—ã„ãƒ”ã‚¶ğŸ•";
            log(`âœ… æ–™ç†ãŒã§ããŸï¼`, "success");
            setStepCompleted("step3");
            resolve(food);
          }, 2000);
        });
      }

      // ã‚¹ãƒ†ãƒƒãƒ—4: ç››ã‚Šä»˜ã‘ã‚‹
      function serve(food) {
        return new Promise(function (resolve) {
          log(`ğŸ½ï¸ ç››ã‚Šä»˜ã‘ã‚‹ï¼ˆ${food}ï¼‰...`, "info");
          setStepActive("step4");

          setTimeout(function () {
            const message = `${food}ã‚’æä¾›ã—ã¾ã™`;
            log(`âœ… å®Œæˆï¼ğŸ½ï¸`, "success");
            setStepCompleted("step4");
            resolve(message);
          }, 1000);
        });
      }

      // ==========================================
      // Promise ãƒã‚§ãƒ¼ãƒ³ã§æ–™ç†ã‚’ä½œã‚‹
      // ==========================================
      function makePizza() {
        log("========================================", "info");
        log("ğŸ¯ æ–™ç†ã‚¹ã‚¿ãƒ¼ãƒˆï¼", "complete");
        log("========================================", "info");

        // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
        startButton.disabled = true;

        // Promise ãƒã‚§ãƒ¼ãƒ³
        buyIngredients()
          .then(function (ingredients) {
            // ã‚¹ãƒ†ãƒƒãƒ—1ãŒå®Œäº†ã—ãŸã‚‰ã€ã‚¹ãƒ†ãƒƒãƒ—2ã¸
            // cutIngredients ã¯ Promise ã‚’è¿”ã™
            return cutIngredients(ingredients);
          })
          .then(function (preparedIngredients) {
            // ã‚¹ãƒ†ãƒƒãƒ—2ãŒå®Œäº†ã—ãŸã‚‰ã€ã‚¹ãƒ†ãƒƒãƒ—3ã¸
            return cook(preparedIngredients);
          })
          .then(function (food) {
            // ã‚¹ãƒ†ãƒƒãƒ—3ãŒå®Œäº†ã—ãŸã‚‰ã€ã‚¹ãƒ†ãƒƒãƒ—4ã¸
            return serve(food);
          })
          .then(function (message) {
            // ã™ã¹ã¦å®Œäº†ï¼
            log("========================================", "complete");
            log(`ğŸ‰ ${message}`, "complete");
            log("ã„ãŸã ãã¾ã™ï¼", "complete");
            log("========================================", "complete");

            // ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
            startButton.disabled = false;
          })
          .catch(function (error) {
            // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸæ™‚ï¼ˆä»Šå›ã¯ç™ºç”Ÿã—ãªã„ã‘ã©ã€æœ¬æ¥ã¯å¿…è¦ï¼‰
            log("========================================", "complete");
            log(`âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ: ${error}`, "complete");
            log("========================================", "complete");

            // ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
            startButton.disabled = false;
          });
      }

      // ==========================================
      // ãƒªã‚»ãƒƒãƒˆé–¢æ•°
      // ==========================================
      function reset() {
        // ã™ã¹ã¦ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’ãƒªã‚»ãƒƒãƒˆ
        Object.values(steps).forEach((step) => {
          step.classList.remove("active", "completed");
        });

        // ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢
        logBox.innerHTML = "";

        log("ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ", "info");

        console.log("========================================");
        console.log("ãƒªã‚»ãƒƒãƒˆå®Œäº†");
        console.log("========================================");
      }

      // ==========================================
      // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
      // ==========================================
      startButton.addEventListener("click", makePizza);
      resetButton.addEventListener("click", reset);

      // ==========================================
      // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®ãƒ­ã‚°
      // ==========================================
      console.log("========================================");
      console.log("å•é¡Œ 3-4: Promise ãƒã‚§ãƒ¼ãƒ³ã§é †ç•ªã«å‡¦ç†");
      console.log("========================================");
      console.log("ã€å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆã€‘");
      console.log("1. Promise ãƒã‚§ãƒ¼ãƒ³ã§è¤‡æ•°ã®éåŒæœŸå‡¦ç†ã‚’é †ç•ªã«å®Ÿè¡Œ");
      console.log("2. å„ .then() ã§æ¬¡ã® Promise ã‚’è¿”ã™ã“ã¨ã§ãƒã‚§ãƒ¼ãƒ³ãŒç¶šã");
      console.log("3. ã‚¨ãƒ©ãƒ¼ã¯æœ€å¾Œã® .catch() 1ã¤ã§å…¨éƒ¨ã‚­ãƒ£ãƒƒãƒã§ãã‚‹");
      console.log("========================================");
      console.log("ã€Promise ãƒã‚§ãƒ¼ãƒ³ã®æ§‹é€ ã€‘");
      console.log("buyIngredients()");
      console.log("  .then(ingredients => cutIngredients(ingredients))");
      console.log("  .then(prepared => cook(prepared))");
      console.log("  .then(food => serve(food))");
      console.log("  .then(message => console.log(message))");
      console.log("  .catch(error => console.error(error))");
      console.log("========================================");
      console.log("ã€Œæ–™ç†ã‚’å§‹ã‚ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã¿ã‚ˆã†ï¼");
      console.log("========================================");

      log("æº–å‚™å®Œäº†ï¼ã€Œæ–™ç†ã‚’å§‹ã‚ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã­", "info");
    </script>
  </body>
</html>
