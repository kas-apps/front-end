<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å•é¡Œ 3-6: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      .container {
        background: white;
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 600px;
        width: 100%;
        text-align: center;
      }

      h1 {
        color: #333;
        margin-bottom: 10px;
        font-size: 28px;
      }

      .subtitle {
        color: #666;
        margin-bottom: 30px;
        font-size: 14px;
      }

      .user-card {
        background: linear-gradient(135deg, #f5f7fa 0%, #f0f3f7 100%);
        border-radius: 15px;
        padding: 30px;
        margin: 30px 0;
        min-height: 200px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        border: 2px solid #e9ecef;
        transition: all 0.3s;
      }

      .user-card.loading {
        background: linear-gradient(135deg, #e3f2fd 0%, #d1e7f7 100%);
        border-color: #4facfe;
      }

      .user-card.success {
        background: linear-gradient(135deg, #d4f7e8 0%, #c7f9e3 100%);
        border-color: #38ef7d;
      }

      .user-card.error {
        background: linear-gradient(135deg, #ffe0e0 0%, #ffd0d0 100%);
        border-color: #ff6b6b;
      }

      .loading-spinner {
        width: 50px;
        height: 50px;
        border: 5px solid rgba(79, 172, 254, 0.2);
        border-radius: 50%;
        border-top-color: #4facfe;
        animation: spinner 0.8s linear infinite;
      }

      .loading-text {
        margin-top: 20px;
        font-size: 18px;
        color: #4facfe;
        font-weight: bold;
      }

      .user-avatar {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 48px;
        margin-bottom: 20px;
      }

      .user-info {
        text-align: center;
      }

      .user-name {
        font-size: 28px;
        font-weight: bold;
        color: #333;
        margin-bottom: 10px;
      }

      .user-age {
        font-size: 18px;
        color: #666;
        margin-bottom: 15px;
      }

      .user-id {
        font-size: 14px;
        color: #999;
        font-family: "Courier New", monospace;
      }

      .error-message {
        font-size: 20px;
        color: #c92a2a;
        font-weight: bold;
        margin-bottom: 10px;
      }

      .error-icon {
        font-size: 60px;
        margin-bottom: 20px;
      }

      .fetch-button {
        padding: 15px 40px;
        font-size: 18px;
        font-weight: bold;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s;
        background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        color: #333;
      }

      .fetch-button:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(168, 237, 234, 0.4);
      }

      .fetch-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none !important;
      }

      .try-catch-flow {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        margin: 30px 0;
      }

      .flow-step {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 10px;
        border: 2px solid #e9ecef;
        text-align: center;
      }

      .flow-step.active {
        border-color: #4facfe;
        background: linear-gradient(135deg, #e3f2fd 0%, #d1e7f7 100%);
      }

      .flow-step-title {
        font-weight: bold;
        margin-bottom: 8px;
        font-size: 14px;
        color: #333;
      }

      .flow-step-desc {
        font-size: 12px;
        color: #666;
        line-height: 1.6;
      }

      .info-box {
        background: #f8f9fa;
        border-left: 4px solid #a8edea;
        padding: 15px;
        margin-top: 30px;
        text-align: left;
        border-radius: 5px;
      }

      .info-box h3 {
        color: #4facfe;
        margin-bottom: 10px;
        font-size: 16px;
      }

      .info-box ul {
        margin-left: 20px;
        color: #666;
        font-size: 14px;
        line-height: 1.8;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        margin-top: 20px;
      }

      .stat-card {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 10px;
        text-align: center;
      }

      .stat-label {
        font-size: 12px;
        color: #666;
        margin-bottom: 5px;
      }

      .stat-value {
        font-size: 24px;
        font-weight: bold;
        color: #4facfe;
      }

      @keyframes spinner {
        to {
          transform: rotate(360deg);
        }
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ›¡ï¸ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°</h1>
      <p class="subtitle">å•é¡Œ 3-6: å¿œç”¨ç·¨</p>

      <div class="try-catch-flow">
        <div class="flow-step" id="tryStep">
          <div class="flow-step-title">try</div>
          <div class="flow-step-desc">å‡¦ç†ã‚’å®Ÿè¡Œ</div>
        </div>
        <div class="flow-step" id="catchStep">
          <div class="flow-step-title">catch</div>
          <div class="flow-step-desc">ã‚¨ãƒ©ãƒ¼æ™‚ã«å®Ÿè¡Œ</div>
        </div>
        <div class="flow-step" id="finallyStep">
          <div class="flow-step-title">finally</div>
          <div class="flow-step-desc">å¿…ãšå®Ÿè¡Œ</div>
        </div>
      </div>

      <div class="user-card" id="userCard">
        <div style="font-size: 48px; color: #999">ğŸ‘¤</div>
        <div style="margin-top: 20px; color: #999">
          ã€Œãƒ‡ãƒ¼ã‚¿å–å¾—ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
        </div>
      </div>

      <button class="fetch-button" id="fetchButton">ãƒ‡ãƒ¼ã‚¿å–å¾—</button>

      <div class="stats">
        <div class="stat-card">
          <div class="stat-label">æˆåŠŸå›æ•°</div>
          <div class="stat-value" id="successCount">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">å¤±æ•—å›æ•°</div>
          <div class="stat-value" id="errorCount">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">åˆè¨ˆè©¦è¡Œ</div>
          <div class="stat-value" id="totalCount">0</div>
        </div>
      </div>

      <div class="info-box">
        <h3>ğŸ’¡ å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ</h3>
        <ul>
          <li>
            try-catch-finally ã‚’ä½¿ã£ã¦å®‰å…¨ã«éåŒæœŸå‡¦ç†ã‚’å®Ÿè¡Œã§ãã‚‹
          </li>
          <li>try: å®Ÿè¡Œã—ãŸã„ã‚³ãƒ¼ãƒ‰ï¼ˆã‚¨ãƒ©ãƒ¼ãŒèµ·ã“ã‚‹ã‹ã‚‚ï¼‰</li>
          <li>catch: ã‚¨ãƒ©ãƒ¼ãŒèµ·ããŸæ™‚ã®å‡¦ç†</li>
          <li>finally: æˆåŠŸã§ã‚‚å¤±æ•—ã§ã‚‚å¿…ãšå®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†</li>
          <li>ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã¯ finally ã§æ¶ˆã™ã®ãŒãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹</li>
        </ul>
      </div>
    </div>

    <script>
      // ==========================================
      // è¦ç´ ã®å–å¾—
      // ==========================================
      const fetchButton = document.getElementById("fetchButton");
      const userCard = document.getElementById("userCard");
      const tryStep = document.getElementById("tryStep");
      const catchStep = document.getElementById("catchStep");
      const finallyStep = document.getElementById("finallyStep");
      const successCountElement = document.getElementById("successCount");
      const errorCountElement = document.getElementById("errorCount");
      const totalCountElement = document.getElementById("totalCount");

      // çµ±è¨ˆæƒ…å ±
      let successCount = 0;
      let errorCount = 0;
      let totalCount = 0;

      // ==========================================
      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹é–¢æ•°ï¼ˆPromise ã‚’è¿”ã™ï¼‰
      // ==========================================
      function getUserData() {
        return new Promise(function (resolve, reject) {
          // 2ç§’å¾Œã«ãƒ©ãƒ³ãƒ€ãƒ ã§æˆåŠŸ/å¤±æ•—
          setTimeout(function () {
            const success = Math.random() > 0.5;

            if (success) {
              // æˆåŠŸæ™‚ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’è¿”ã™
              const user = {
                id: "USER" + Math.floor(Math.random() * 10000),
                name: "å¤ªéƒ",
                age: 25,
                avatar: "ğŸ‘¨",
              };
              resolve(user);
            } else {
              // å¤±æ•—æ™‚ï¼šã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™
              reject(new Error("ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ"));
            }
          }, 2000);
        });
      }

      // ==========================================
      // ãƒ‡ãƒ¼ã‚¿å–å¾—å‡¦ç†ï¼ˆasync/await + try-catch-finallyï¼‰
      // ==========================================
      async function fetchUserData() {
        console.log("========================================");
        console.log("ãƒ‡ãƒ¼ã‚¿å–å¾—é–‹å§‹");

        // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
        fetchButton.disabled = true;

        // ãƒ•ãƒ­ãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ
        resetFlowSteps();

        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã‚’å‡ºã™
        showLoading();
        console.log("ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã‚’å‡ºã—ã¾ã—ãŸ");

        // try ã‚¹ãƒ†ãƒƒãƒ—ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
        tryStep.classList.add("active");

        try {
          console.log("try ãƒ–ãƒ­ãƒƒã‚¯: ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’è©¦ã¿ã¾ã™");

          // await ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã‚’å¾…ã¤
          const user = await getUserData();

          console.log("âœ… ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ:", user);

          // æˆåŠŸæ™‚ã®å‡¦ç†
          showUserData(user);

          // çµ±è¨ˆã‚’æ›´æ–°
          successCount++;
          successCountElement.textContent = successCount;
        } catch (error) {
          console.log("âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ");
          console.error("ã‚¨ãƒ©ãƒ¼è©³ç´°:", error);

          // catch ã‚¹ãƒ†ãƒƒãƒ—ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
          catchStep.classList.add("active");

          // å¤±æ•—æ™‚ã®å‡¦ç†
          showError(error.message);

          // çµ±è¨ˆã‚’æ›´æ–°
          errorCount++;
          errorCountElement.textContent = errorCount;
        } finally {
          console.log("finally ãƒ–ãƒ­ãƒƒã‚¯: å¿…ãšå®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†");

          // finally ã‚¹ãƒ†ãƒƒãƒ—ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
          finallyStep.classList.add("active");

          // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã‚’æ¶ˆã™ï¼ˆæˆåŠŸã§ã‚‚å¤±æ•—ã§ã‚‚å®Ÿè¡Œã•ã‚Œã‚‹ï¼‰
          hideLoading();
          console.log("ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã‚’æ¶ˆã—ã¾ã—ãŸ");

          // ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
          fetchButton.disabled = false;

          // çµ±è¨ˆã‚’æ›´æ–°
          totalCount++;
          totalCountElement.textContent = totalCount;

          console.log("========================================");
          console.log(`çµ±è¨ˆ: æˆåŠŸ ${successCount}å› / å¤±æ•— ${errorCount}å›`);
          console.log("========================================");
        }
      }

      // ==========================================
      // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
      // ==========================================
      function showLoading() {
        userCard.className = "user-card loading";
        userCard.innerHTML = `
          <div class="loading-spinner"></div>
          <div class="loading-text">èª­ã¿è¾¼ã¿ä¸­...</div>
        `;
      }

      function hideLoading() {
        // finallyã§å‘¼ã°ã‚Œã‚‹ã®ã§ã€ã“ã“ã§ã¯ä½•ã‚‚ã—ãªã„
        // ï¼ˆshowUserData ã¾ãŸã¯ showError ã§è¡¨ç¤ºãŒæ›´æ–°ã•ã‚Œã‚‹ï¼‰
      }

      // ==========================================
      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºï¼ˆæˆåŠŸæ™‚ï¼‰
      // ==========================================
      function showUserData(user) {
        userCard.className = "user-card success";
        userCard.innerHTML = `
          <div class="user-avatar">${user.avatar}</div>
          <div class="user-info">
            <div class="user-name">${user.name}ã•ã‚“</div>
            <div class="user-age">${user.age}æ­³</div>
            <div class="user-id">ID: ${user.id}</div>
          </div>
        `;
      }

      // ==========================================
      // ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºï¼ˆå¤±æ•—æ™‚ï¼‰
      // ==========================================
      function showError(message) {
        userCard.className = "user-card error";
        userCard.innerHTML = `
          <div class="error-icon">âŒ</div>
          <div class="error-message">ãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—</div>
          <div style="color: #666; font-size: 14px;">${message}</div>
        `;
      }

      // ==========================================
      // ãƒ•ãƒ­ãƒ¼ã‚¹ãƒ†ãƒƒãƒ—ã‚’ãƒªã‚»ãƒƒãƒˆ
      // ==========================================
      function resetFlowSteps() {
        tryStep.classList.remove("active");
        catchStep.classList.remove("active");
        finallyStep.classList.remove("active");
      }

      // ==========================================
      // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
      // ==========================================
      fetchButton.addEventListener("click", fetchUserData);

      // ==========================================
      // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®ãƒ­ã‚°
      // ==========================================
      console.log("========================================");
      console.log("å•é¡Œ 3-6: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°");
      console.log("========================================");
      console.log("ã€å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆã€‘");
      console.log("1. try-catch-finally ã§ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°");
      console.log("2. try: å®Ÿè¡Œã—ãŸã„ã‚³ãƒ¼ãƒ‰");
      console.log("3. catch: ã‚¨ãƒ©ãƒ¼æ™‚ã®å‡¦ç†");
      console.log("4. finally: å¿…ãšå®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†");
      console.log("========================================");
      console.log("ã€try-catch-finally ã®å®Ÿè¡Œé †åºã€‘");
      console.log("");
      console.log("æˆåŠŸæ™‚:");
      console.log("  try â†’ æˆåŠŸ â†’ finally");
      console.log("");
      console.log("å¤±æ•—æ™‚:");
      console.log("  try â†’ ã‚¨ãƒ©ãƒ¼ â†’ catch â†’ finally");
      console.log("");
      console.log("========================================");
      console.log("ã€ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã€‘");
      console.log("");
      console.log("// ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã¯ finally ã§æ¶ˆã™");
      console.log("async function() {");
      console.log("  showLoading();  // å‡¦ç†é–‹å§‹å‰ã«è¡¨ç¤º");
      console.log("  try {");
      console.log("    const data = await getData();");
      console.log("    showData(data);");
      console.log("  } catch (error) {");
      console.log("    showError(error);");
      console.log("  } finally {");
      console.log("    hideLoading();  // å¿…ãšå®Ÿè¡Œã•ã‚Œã‚‹");
      console.log("  }");
      console.log("}");
      console.log("");
      console.log("========================================");
      console.log("ã€Œãƒ‡ãƒ¼ã‚¿å–å¾—ã€ãƒœã‚¿ãƒ³ã‚’ä½•åº¦ã‹ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€");
      console.log("æˆåŠŸã¨å¤±æ•—ã®é•ã„ã‚’ç¢ºèªã—ã¦ã¿ã‚ˆã†ï¼");
      console.log("finally ãŒå¿…ãšå®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ã‚‚ãƒã‚§ãƒƒã‚¯ï¼");
      console.log("========================================");
    </script>
  </body>
</html>
